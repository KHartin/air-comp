---
title: "PM Composition in Rural Yunan Province China"
author: "Kris Hartin"
date: "May 8, 2015"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

Load the required packages

```{r}
pkgs <- c("knitr", "XLConnect")
for (pkg in pkgs) {
    if (! require(pkg, character.only=T)) { 
        install.packages(pkg, repos="http://cran.fhcrc.org", dependencies=TRUE)
        suppressPackageStartupMessages(library(pkg))
    }
}
```

Configure knitr options

```{r}
opts_chunk$set(tidy=FALSE, cache=FALSE)
```

Create the data folder

```{r}
datadir <- "data"
dir.create(file.path(datadir), showWarnings=FALSE, recursive=TRUE)
```

Identify Worksheet

```{r}
datafile <- 'Batch AA results.xlsx'
datafileout <- paste(c(datadir, '/', datafile), sep='', collapse='')
```

Import worksheet (Need to repeat for each dataset)
```{r}
library(XLConnect)
XRF <- readWorksheetFromFile(datafileout, sheet=1, header=TRUE,
                                  startRow=8, endRow=46)
```

Remove unwanted Columns from XRF


Upload the dataset, exclude results from Xuanwei city, view table
<<<<<<< HEAD
=======

>>>>>>> 39c310c11e81dfa68b8fc9e1136d68e6a9fc331a
```{r}
Xuanwei_ForAnalysis_31Mar15 <- read.csv("H:/Seto_Projects/Xuanwei/Xuanwei_ForAnalysis_31Mar15.csv")
X<-subset(Xuanwei_ForAnalysis_31Mar15, village != "Xuanwei")
```

Reduce number of metals to those with at least 10 greater than 2*Unc
<<<<<<< HEAD
=======

>>>>>>> 39c310c11e81dfa68b8fc9e1136d68e6a9fc331a
```{r}
grepl("Unc",names(X))
metals.unc <- names(X)[grepl("Unc",names(X))]

v<-vector()

for(i in 1:length(names(X))){
  if(grepl("Unc",names(X)[i])){
    if(sum(X[,i-1]>X[,i]*2)>10){
    v<-c(v,paste(names(X)[i-1],"V",sep=""))
  }
}
}  
```

Calculate arithmetic mean of data by site
<<<<<<< HEAD
```{r}
=======
```{R}
library(doBy)
>>>>>>> 39c310c11e81dfa68b8fc9e1136d68e6a9fc331a
v<-c(v,names(X)[grepl("ugV",names(X))])

this.formula <- as.character("conc~location + sitenum")  
for (i in v){
  this.formula <- paste(i,this.formula, sep = "+")
}

am.site <- summaryBy(as.formula(this.formula), data=X, id = "village", keep.names=TRUE, FUN=mean)
```

Create new objects -> Home, Ambient, Mean and Geometric Mean Home Concentrations ####

```{r}
is.home <- subset(X, location == "Home")
is.ambient <- subset(X, location == "Ambient")
```

Plots of Conc by Site, Differentiating Indoor and Outdoor 
```{r}
plot(X$conc~X$sitenum,log="y",ylab="Concentration ug/m^3", xlab="Site Number",
     main="PM2.5 Concentration by Site")

```

